-- LcL Tools - åŒæ­¥å¯¼å…¥æ ¸å¿ƒåŠŸèƒ½
-- åŸºäºSyncBlenderæ”¹å†™ï¼Œä¸“é—¨å¤„ç†Blenderåˆ°Maxçš„å¯¼å…¥

-- å¯¼å…¥FBXå‡½æ•°
fn LcL_ImportFBX = 
(
    -- ä½¿ç”¨ä¸å¯¼å‡ºç›¸åŒçš„ä¸´æ—¶ç›®å½•å’Œæ–‡ä»¶
    local fbxFilePath = ""
    if lclSyncConfig == undefined then
    (
        format "âš  å¯¼å‡ºé…ç½®æœªåŠ è½½ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„\n"
        local tempDir = (sysInfo.tempdir + "LcL_Tools_Exchange\\")
        fbxFilePath = tempDir + "export_model.fbx"
    )
    else
    (
        fbxFilePath = lclSyncConfig.exportFile
    )
    
    -- æ£€æŸ¥FBXæ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if not (doesFileExist fbxFilePath) then
    (
        errorMsg = "æœªæ‰¾åˆ°FBXæ–‡ä»¶ï¼\n\nè¯·å…ˆä»Blenderå¯¼å‡ºæ–‡ä»¶åˆ°ï¼š\n" + fbxFilePath
        messageBox errorMsg title:"æ–‡ä»¶ä¸å­˜åœ¨"
        return false
    )
    
    format "ğŸš€ å¼€å§‹å¯¼å…¥FBXæ–‡ä»¶: %\n" fbxFilePath
    
    -- ç®€åŒ–å¯¼å…¥ï¼Œä½¿ç”¨FBXIMPå¯¼å…¥å™¨
    try
    (
        importFile fbxFilePath #noPrompt using:FBXIMP
        format "âœ… å¯¼å…¥æˆåŠŸï¼\n"
        format "ğŸ“ æ–‡ä»¶ä½ç½®: %\n" fbxFilePath
    )
    catch
    (
        format "âŒ å¯¼å…¥å¤±è´¥: %\n" (getCurrentException())
        return false
    )
    
    return true
)

-- å¿«é€Ÿå¯¼å…¥å‡½æ•°ï¼ˆB2M - Blender to Maxï¼‰
fn LcL_QuickImport = 
(
    result = LcL_ImportFBX()
    
    -- å¯¼å…¥æˆåŠŸæ—¶ä¸å¼¹çª—ï¼Œåªåœ¨ç›‘å¬å™¨è¾“å‡ºä¿¡æ¯
    if result then
    (
        local fileName = if lclSyncConfig != undefined then 
            (filenameFromPath lclSyncConfig.exportFile) 
        else 
            "export_model.fbx"
        format "ğŸ“¥ å¯¼å…¥å®Œæˆï¼š%\n" fileName
    )
    
    return result
)

-- è·å–å¯¼å…¥ä¿¡æ¯
fn LcL_GetImportInfo = 
(
    info = ""
    
    local importFile = if lclSyncConfig != undefined then 
        lclSyncConfig.exportFile 
    else 
        ((sysInfo.tempdir + "LcL_Tools_Exchange\\") + "export_model.fbx")
        
    info += "å¯¼å…¥æ–‡ä»¶: " + (filenameFromPath importFile) + "\n"
    info += "æ–‡ä»¶è·¯å¾„: " + importFile + "\n"
    
    if (doesFileExist importFile) then
    (
        fileInfo = getFileSize importFile
        info += "æ–‡ä»¶å¤§å°: " + (fileInfo / 1024.0) as string + " KB\n"
        info += "æ–‡ä»¶çŠ¶æ€: å­˜åœ¨\n"
    )
    else
    (
        info += "æ–‡ä»¶çŠ¶æ€: ä¸å­˜åœ¨\n"
    )
    
    return info
)

format "âœ… LcL Tools åŒæ­¥å¯¼å…¥æ ¸å¿ƒåŠ è½½å®Œæˆ\n"